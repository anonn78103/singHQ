<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Experiments â€” Index</title>
  <style>
    :root{--bg:#0b0f14;--card:#0f1720;--muted:#9aa4b2;--accent:#60a5fa}
    html,body{height:100%;margin:0;background:var(--bg);color:#e6eef6;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .container{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 18px;color:var(--muted)}
    .card{background:var(--card);padding:14px;border-radius:8px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    ul.file-list{list-style:none;padding:0;margin:0}
    li.file{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .meta{display:flex;gap:12px;align-items:center}
    .name{font-family:monospace}
    .actions a, .actions button{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:6px;color:var(--muted);text-decoration:none;cursor:pointer}
    .actions a:hover,.actions button:hover{border-color:var(--accent);color:#fff}
    .viewer{margin-top:16px}
    pre{white-space:pre-wrap;word-break:break-word;max-height:520px;overflow:auto;padding:12px;border-radius:6px;background:#071023;border:1px solid rgba(255,255,255,0.02)}
    .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:10px}
    .hidden{display:none}
    a.home{color:var(--accent);text-decoration:none}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    @media (max-width:600px){.container{padding:12px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Experiments</h1>
    </header>
    <p class="lead">Browse experiments. Use the <code>/py</code> path or <a href="#/py" class="home">#/py</a> to view the list of files and open any file to preview or download.</p>

    <div id="content" class="card">
      <div id="homeView">
        <p>Click below to go to the experiments list.</p>
        <p><a href="#/py" class="home">Open experiments list (#/py)</a></p>
      </div>

      <div id="listView" class="hidden">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <strong>Available files</strong>
          <div><input id="filter" placeholder="filter (e.g. .py or KMeans)" style="padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit"></div>
        </div>
        <ul class="file-list" id="fileList"></ul>

        <div class="viewer" id="viewer" class="hidden">
          <div class="toolbar">
            <button id="closeViewer">Close</button>
            <button id="copyBtn">Copy</button>
            <a id="downloadBtn" href="#" download>Download</a>
            <span id="viewerInfo" style="color:var(--muted);margin-left:8px"></span>
          </div>
          <pre id="fileContent"><em>Select a file to preview.</em></pre>
        </div>
      </div>

    </div>
    <footer>Note: This page expects the files to be hosted alongside this HTML (same directory or in a <code>files/</code> folder). If preview fails, click the file name to open in a new tab.</footer>
  </div>

<script>
// === EDIT THIS LIST IF NEEDED ===
const ALL_FILES = [
  "DecisionTree.py",
  "Hireachical.py",
  "KMeans.py",
  "LinerRegression.py",
  "OLAP_opration.py",
  "apiori.py",
  "drug200.csv",
  "index.html",
  "insta.csv",
  "requirements.txt",
  "sales.csv",
  "transactions_onehot_250.csv",
  "xy.py"
];
// =================================

const fileListEl = document.getElementById('fileList');
const listView = document.getElementById('listView');
const homeView = document.getElementById('homeView');
const viewer = document.getElementById('viewer');
const fileContent = document.getElementById('fileContent');
const viewerInfo = document.getElementById('viewerInfo');
const downloadBtn = document.getElementById('downloadBtn');
const copyBtn = document.getElementById('copyBtn');
const closeViewer = document.getElementById('closeViewer');
const filterInput = document.getElementById('filter');

function showList(){
  homeView.classList.add('hidden');
  listView.classList.remove('hidden');
  renderList(ALL_FILES);
}

function renderList(files){
  fileListEl.innerHTML = '';
  files.forEach(name=>{
    const li = document.createElement('li');
    li.className='file';
    const meta = document.createElement('div');
    meta.className='meta';
    const span = document.createElement('span');
    span.className='name';
    span.textContent = name;
    meta.appendChild(span);

    const actions = document.createElement('div');
    actions.className = 'actions';

    const viewBtn = document.createElement('button');
    viewBtn.textContent = 'View';
    viewBtn.addEventListener('click', ()=>openFile(name));

    const openLink = document.createElement('a');
    openLink.href = name;
    openLink.target = '_blank';
    openLink.textContent = 'Open';

    const dl = document.createElement('a');
    dl.href = name;
    dl.setAttribute('download','');
    dl.textContent = 'Download';

    actions.appendChild(viewBtn);
    actions.appendChild(openLink);
    actions.appendChild(dl);

    li.appendChild(meta);
    li.appendChild(actions);
    fileListEl.appendChild(li);
  });
}

async function openFile(name){
  viewer.classList.remove('hidden');
  document.getElementById('viewer').style.display='block';
  viewerInfo.textContent = name;
  downloadBtn.href = name;
  try{
    const res = await fetch(name);
    if(!res.ok) throw new Error('fetch failed');
    const text = await res.text();
    // simple pretty for CSV: show first 2000 chars then full
    fileContent.textContent = text;
  }catch(err){
    fileContent.textContent = 'Unable to preview file. It might be binary or the host prevents fetch.\nYou can still open in a new tab using the Open link.';
  }
}

closeViewer.addEventListener('click', ()=>{
  viewer.classList.add('hidden');
  fileContent.textContent = '';
  viewerInfo.textContent = '';
});

copyBtn.addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(fileContent.textContent);
    copyBtn.textContent = 'Copied';
    setTimeout(()=>copyBtn.textContent='Copy',900);
  }catch(e){
    copyBtn.textContent='Copy failed';
    setTimeout(()=>copyBtn.textContent='Copy',900);
  }
});

filterInput.addEventListener('input', ()=>{
  const q = filterInput.value.trim().toLowerCase();
  const filtered = ALL_FILES.filter(f=>f.toLowerCase().includes(q));
  renderList(filtered);
});

// routing: support path /py and hash #/py
function router(){
  const path = location.pathname || '/';
  const hash = location.hash || '';
  if(path.endsWith('/py') || hash === '#/py'){
    showList();
  }else{
    homeView.classList.remove('hidden');
    listView.classList.add('hidden');
  }
}

window.addEventListener('popstate', router);
window.addEventListener('hashchange', router);
router();
</script>
</body>
</html>
