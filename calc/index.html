<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="http://takeinfo.me/assets/images/icon_TROPHY-modified.png">

    <title>Winrate Calculator (Last 50 Battles)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(to bottom right, #0F2027, #203A43, #2C5364);
        }

        .container {
            background: #1E3A5F;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            color: #fff;
            width: 320px;
        }

        h2 {
            font-size: 22px;
            margin-bottom: 10px;
        }

        .score {
            font-size: 30px;
            font-weight: bold;
            margin: 10px 0;
            cursor: pointer;
            border: none;
            background: none;
            color: white;
            text-align: center;
            width: 100px;
            outline: none;
        }

        .percentage {
            font-size: 20px;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        button {
            border: none;
            padding: 12px 20px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.3s;
        }

        .increase {
            background: #28A745;
            color: #fff;
        }

        .decrease {
            background: #DC3545;
            color: #fff;
        }

        .reset {
            background: #FFC107;
            color: #333;
            width: 100%;
            margin-top: 15px;
        }

        .history-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .undo,
        .redo {
            background: #007BFF;
            color: white;
            width: 45%;
        }

        button:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>üèÜWinrate CalculatorüèÜ</h2>
        <input class="score" id="score" type="text" value="0/0" onblur="editScore()">
        <div class="percentage" id="percentage">NaN%</div>
        <div class="buttons">
            <button class="decrease" onclick="decreaseWin()">-</button>
            <button class="increase" onclick="increaseWin()">+</button>
        </div>
        <button class="reset" onclick="resetWinrate()">Reset</button>
        <div class="history-buttons">
            <button class="undo disabled" id="undoBtn" onclick="undo()">‚è™ Undo</button>
            <button class="redo disabled" id="redoBtn" onclick="redo()">‚è© Redo</button>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log("Service Worker Registered", reg))
        .catch(err => console.log("Service Worker Registration Failed", err));
             }

        let battles = [];
        let history = [];
        let historyIndex = -1;

        function saveState() {
            if (history.length >= 50) history.shift();
            history.push([...battles]);
            historyIndex = history.length - 1;
            updateButtons();
            localStorage.setItem("battleHistory", JSON.stringify(history));
            localStorage.setItem("historyIndex", historyIndex);
        }

        function updateDisplay() {
            let last50 = battles.slice(-50);
            let totalWins = last50.reduce((sum, val) => sum + val, 0);
            let totalMatches = last50.length;
            document.getElementById("score").value = `${totalWins}/${totalMatches}`;
            document.getElementById("percentage").innerText = totalMatches === 0 ? "NaN%" : ((totalWins / totalMatches) * 100).toFixed(2) + "%";
            localStorage.setItem("battles", JSON.stringify(battles));
            updateButtons();
        }

        function updateButtons() {
            document.getElementById("undoBtn").classList.toggle("disabled", historyIndex <= 0);
            document.getElementById("redoBtn").classList.toggle("disabled", historyIndex >= history.length - 1);
        }

        function increaseWin() {
            battles.push(1);
            saveState();
            updateDisplay();
        }

        function decreaseWin() {
            battles.push(0);
            saveState();
            updateDisplay();
        }

        function resetWinrate() {
            battles = [];
            saveState();  
            updateDisplay();
        }


        function editScore() {
            let input = document.getElementById("score").value;
            let parts = input.split("/");
            let newWins = parseInt(parts[0]);
            let newMatches = parseInt(parts[1]);

            if (!isNaN(newWins) && !isNaN(newMatches) && newWins <= newMatches) {
                let newBattles = new Array(newMatches).fill(0);
                for (let i = 0; i < newWins; i++) newBattles[i] = 1;
                battles = newBattles;
                saveState();
                updateDisplay();
            } else {
                updateDisplay();
            }
        }

        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                battles = [...history[historyIndex]];
                updateDisplay();
            }
        }

        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                battles = [...history[historyIndex]];
                updateDisplay();
            }
        }

        function loadStoredData() {
            let storedBattles = localStorage.getItem("battles");
            let storedHistory = localStorage.getItem("battleHistory");
            let storedIndex = localStorage.getItem("historyIndex");

            if (storedBattles) battles = JSON.parse(storedBattles);
            if (storedHistory) history = JSON.parse(storedHistory);
            if (storedIndex) historyIndex = parseInt(storedIndex);

            updateDisplay();
        }

        window.onload = loadStoredData;
    </script>

<script type="text/javascript" src="/unprotected/back_to_spaceship.js?hash=4975d460e508829e8fb64d3962bc44ad35f3a95a"></script>

</body>

</html>