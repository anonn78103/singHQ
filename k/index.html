<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Live Stocks Result!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        :root{
            --card-radius: 28px;
            --accent-1: #6c63ff;
            --accent-2: #9179f3;
            --muted: #686a7e;
            --dark: #131d33;
        }

        html,body{
            height:100%;
            margin:0;
            padding:0;
            font-family: Arial, Helvetica, sans-serif;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            background: url('/static/money.png') center center/cover no-repeat fixed;
        }

        /* subtle overlay so card text is readable on phones */
        body::before{
            content:"";
            position:fixed;
            inset:0;
            background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.08));
            pointer-events:none;
            z-index:0;
        }

        .center-card{
            position:relative;
            z-index:1;
            width:94vw;
            max-width:720px;
            margin:40px auto;
            background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(250,250,255,0.92));
            border-radius: var(--card-radius);
            box-shadow: 0 10px 40px rgba(20,20,50,0.18);
            padding:40px 28px;
            backdrop-filter: blur(8px) saturate(120%);
            display:flex;
            flex-direction:column;
            align-items:center;
        }

        h1{
            font-size:2.2rem;
            color:var(--dark);
            margin:0 0 8px 0;
            font-weight:700;
            display:flex;
            align-items:center;
            gap:12px;
        }

        h1::before{
            content:'';
            display:inline-block;
            width:36px;
            height:36px;
            background: url('data:image/svg+xml,<svg fill="none" viewBox="0 0 24 24" stroke="black" xmlns="http://www.w3.org/2000/svg"><path d="M3 17V9.5A2.5 2.5 0 0 1 7.24 7.69l2.73.89a2.5 2.5 0 0 0 1.62-.02l2.5-.84a2.5 2.5 0 0 1 2.84.72A5.52 5.52 0 0 1 21 14.5V17" stroke="%23151725" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 21h2m4 0h2m-8-4h8" stroke="%236c63ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>') no-repeat center/32px;
        }

        p.lead{
            margin:6px 0 20px 0;
            color:#32344a;
            font-size:1.05rem;
            text-align:center;
        }

        .search-wrap{
            width:100%;
            max-width:640px;
            display:flex;
            gap:0;
            margin-bottom:12px;
        }

        .search-wrap input[type="text"]{
            flex:1;
            padding:14px 16px 14px 46px;
            border-radius:12px 0 0 12px;
            border:2px solid rgba(170,177,236,0.95);
            background: #f6f7ff url('data:image/svg+xml,<svg fill="none" viewBox="0 0 24 24" stroke="gray" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="11" width="11" height="8" rx="2" stroke="%23999" stroke-width="2"/><path d="M7 11V7.5A2.5 2.5 0 0 1 9.5 5h2A2.5 2.5 0 0 1 14 7.5v3.5" stroke="%23999" stroke-width="2"/></svg>') no-repeat 14px center/22px;
            font-size:1.05rem;
            color:#1f2a44;
            outline:none;
        }

        .search-wrap button{
            border:none;
            padding:12px 26px;
            border-radius:0 12px 12px 0;
            background: linear-gradient(90deg,var(--accent-1) 60%, var(--accent-2));
            color:white;
            font-weight:700;
            cursor:pointer;
            box-shadow:0 3px 10px rgba(108,99,255,0.12);
        }

        .powered{
            margin:8px 0 6px 0;
            color:var(--muted);
            font-size:0.95rem;
        }

        /* results area */
        .results-wrap{
            width:100%;
            display:flex;
            justify-content:center;
            margin-top:14px;
        }

        .result-card{
            width:100%;
            max-width:680px;
            background: transparent;
            border-radius: var(--card-radius);
            box-shadow: none;
            padding: 0;
            overflow: visible;
        }

        /* wrapper that creates the rounded corners for scroll content */
        .table-shell{
            border-radius: 18px;
            overflow:hidden;
            background: rgba(255,255,255,0.98);
            box-shadow: 0 6px 20px rgba(30,30,60,0.08);
            padding: 10px;
        }

        .result-table-scroll{
            max-height: 360px;
            overflow:auto;
            -webkit-overflow-scrolling:touch;
            border-radius:12px;
        }

        table {
            width:100%;
            min-width: 560px;
            border-collapse: collapse;
            font-size:1rem;
            color:#1d2340;
        }

        th, td{
            padding:12px 10px;
            border-bottom:1px solid rgba(180,180,200,0.35);
            text-align:left;
        }

        th{
            background: linear-gradient(180deg,var(--accent-1), var(--accent-2));
            color:#fff;
            font-weight:700;
            position: sticky;
            top:0;
            z-index:2;
        }

        tr:nth-child(even) td{
            background: #faf9ff;
        }

        /* small-screen responsive table: transform rows into cards */
        @media (max-width:620px){
            .center-card{ margin:20px 10px; padding:18px 14px; border-radius:20px; }
            h1{ font-size:1.6rem; gap:8px; }
            p.lead{ font-size:1rem; margin-bottom:12px; }
            .search-wrap input[type="text"]{ padding:12px 12px 12px 42px; font-size:0.98rem; border-radius:10px 0 0 10px; }
            .search-wrap button{ padding:11px 12px; font-size:0.95rem; border-radius:0 10px 10px 0; }

            table{ min-width: unset; font-size:0.98rem; }
            th, td{ padding:12px 12px; }

            /* convert table to stacked cards for each row */
            .result-table-scroll table, .result-table-scroll thead, .result-table-scroll tbody, .result-table-scroll th, .result-table-scroll td, .result-table-scroll tr {
                display:block;
                width:100%;
            }

            .result-table-scroll thead { display:none; }

            .result-table-scroll tr{
                margin-bottom:12px;
                background: #fff;
                border-radius:10px;
                box-shadow:0 4px 12px rgba(20,20,50,0.04);
                overflow:hidden;
            }

            .result-table-scroll td{
                display:flex;
                justify-content:space-between;
                padding:10px 14px;
                border-bottom: none;
                border-left: none;
            }

            .result-table-scroll td::before{
                content: attr(data-label);
                font-weight:600;
                color:#4a4d73;
                margin-right:8px;
                flex:0 0 48%;
            }

            .result-table-scroll td span{
                display:inline-block;
                text-align:right;
                width: 52%;
                color:#101326;
                font-weight:600;
            }

            .result-table-scroll .no-results{
                padding:18px;
                text-align:center;
                color:var(--muted);
            }

            .table-shell { padding:8px; border-radius:14px; }
            .result-table-scroll{ max-height: 420px; }
        }

        /* loading spinner and messages */
        .loading-spinner{
            width:38px;
            height:38px;
            border-radius:50%;
            border:4px solid #eee;
            border-top-color:var(--accent-1);
            animation:spin .92s linear infinite;
            margin:22px auto;
        }

        @keyframes spin{ from{transform:rotate(0)} to{transform:rotate(360deg)} }

        .bold-results-notice {
            padding:20px;
            text-align:center;
            font-size:1.12rem;
            color:#d03434;
            font-weight:700;
        }

        /* scrollbar tweaks */
        .result-table-scroll::-webkit-scrollbar{ height:8px; width:8px; }
        .result-table-scroll::-webkit-scrollbar-thumb{ background: rgba(120,120,160,0.35); border-radius:10px; }
    </style>
</head>

<body>
    <div class="center-card" role="main">
        <h1>Live Company Result Search</h1>
        <p class="lead">Search for company financial results</p>

        <form class="search-wrap" id="stockSearchForm" autocomplete="off">
            <input type="text" placeholder="Enter company name (e.g., Reliance, TCS, Infosys)" id="searchInput" />
            <button type="submit" id="searchBtn">Search</button>
        </form>

        <div class="powered">&#8505; Powered by אונניני • Real-time company data</div>

        <div class="results-wrap" id="resultsWrap" aria-live="polite"></div>
    </div>

    <script>
        const form = document.getElementById('stockSearchForm');
        const input = document.getElementById('searchInput');
        const resultsWrap = document.getElementById('resultsWrap');
        const searchBtn = document.getElementById('searchBtn');
        let fetching = false;

        function showLoading(isLoading) {
            resultsWrap.innerHTML = isLoading
                ? `<div class="result-card"><div class="table-shell"><div class="loading-spinner" aria-hidden="true"></div></div></div>`
                : "";
        }

        function showResults(data) {
            fetching = false;
            searchBtn.disabled = false;
            input.value = '';
            if (!Array.isArray(data)) {
                resultsWrap.innerHTML = `<div class="result-card"><div class="table-shell"><div class="bold-results-notice">Invalid response from server</div></div></div>`;
                return;
            }
            if (data.length === 0) {
                resultsWrap.innerHTML = `<div class="result-card"><div class="table-shell"><div class="bold-results-notice">No Results Found!</div></div></div>`;
                return;
            }

            // desktop / wide: render table; mobile will restyle via CSS to card rows
            let html = `<div class="result-card"><div class="table-shell"><div class="result-table-scroll"><table><thead><tr><th>Security Code</th><th>Security Name</th><th>Result Date</th></tr></thead><tbody>`;
            data.forEach(item => {
                const code = item.SecurityCode || "";
                const name = item.SecurityName || "";
                const date = item.ResultDate || "";
                html += `<tr>
                            <td data-label="Security Code"><span>${code}</span></td>
                            <td data-label="Security Name"><span>${name}</span></td>
                            <td data-label="Result Date"><span>${date}</span></td>
                         </tr>`;
            });
            html += `</tbody></table></div></div></div>`;
            resultsWrap.innerHTML = html;
        }

        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (fetching) return;
            const query = input.value.trim();
            if (!query) return;
            fetching = true;
            searchBtn.disabled = true;
            showLoading(true);

            // your existing /search endpoint
            fetch(`/search?q=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(data => showResults(data))
                .catch(err => {
                    console.error(err);
                    fetching = false;
                    searchBtn.disabled = false;
                    resultsWrap.innerHTML = `<div class="result-card"><div class="table-shell"><div class="bold-results-notice">Error fetching data</div></div></div>`;
                });
        });
    </script>
</body>

</html>
